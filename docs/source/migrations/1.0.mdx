---
title: Apollo iOS 1.0 migration guide
description: From 0.x to 1.0
---

import SetupCodegen from "../../shared/setup-codegen/combined.mdx"

Apollo iOS 1.0 provides a stable API that uses modern Swift language conventions and features. Among other improvements, it features:

- New generated models that improve readability and functionality while reducing generated code size in most cases
- New code generation tooling that is written in pure Swift code
- Support for using generated models in multi-module projects
- Type-safe APIs for cache key resolution

Because most of the library's core concepts are unchanged, the migration to 1.0 from the legacy 0.x versions of Apollo iOS should not require serious rewrites in most cases. This page describes the most important changes, along with how to migrate an existing project from Apollo iOS 0.x to 1.0.

## Step-by-step instructions

To begin your migration to Apollo iOS 1.0 you'll need to:

- [Update your dependency to Apollo iOS version 1.0](#1-update-to-apollo-ios-10)
- [Setup code generation](#2-setup-code-generation)
- [Replace the code generation build phase](#3-replace-the-code-generation-build-phase)
- [Refactor your code to use the new APIs](#4-refactor-your-code)

Much of the migration process involves the new code generation mechanism, which is detailed in this step-by-step guide. It will walk you through this process, explaining how to remove deprecated pieces of the legacy 0.x version along the way.

Below the step-by-step instructions, you will find explanations of each breaking API change in Apollo iOS 1.0.

### 1. Update to Apollo iOS 1.0

The first step in the migration is to update your dependency to the latest version. Apollo iOS can be included as a package using Swift Package Manager (SPM) or Cocoapods.

In order to receive bug fixes and new features, we recommend including `1.0` up to the next major release.

<CodeColumns cols={2}>

```swift title="Package.swift"
.package(
    url: "https://github.com/apollographql/apollo-ios.git",
    .upToNextMajor(from: "1.0.0")
),
```

```ruby title="Podfile"
pod 'Apollo' ~> '1.0'
```

</CodeColumns>

### TODO: Add step on target linking w/ link to target-linking docs.

> **Note:** Apollo iOS 1.0 supports being built as a dynamic `.xcframework` or as a static library. While our documentation does not provide step-by-step instructions on this process, building and including Apollo iOS 1.0 as a pre-compiled binary with a build tool such as Carthage or Buck is possible.

### 2. Setup code generation

Apollo iOS 1.0 includes a new code generation engine, written in 100% Swift code, to replace the legacy `apollo-tooling` code generation. To use 1.0, you will need to install the new code generation engine and remove the old engine.

The recommended way to use the new code generation engine is through the Apollo Codegen CLI. For advanced usage, you can run code generation in a Swift script.

#### Codegen CLI setup

For CLI setup instructions, select the method you are using to include `Apollo`.

### TODO: Improve configuration setup to explain module types

<SetupCodegen />

#### Swift scripts setup

If you are [running code generation using a Swift script](./../code-generation/run-codegen-in-swift-code), update your swift script to use the version of `ApolloCodgenLib` matching your `Apollo` version.

Then, update your `ApolloCodegenConfiguration` in your script with the new configuration values. All configuration options can be found in the [Codegen configuration documentation](./../code-generation/codegen-configuration).

### 3. Replace the code generation build phase

Running Apollo's code generation as an Xcode build phase is no longer recommended. Generated files only change when you modify your `.graphql` operation definitions, which usually happens infrequently. Running code generation on every build causes increased build times and a slower development process. Instead, we recommend that you run code generation manually using the CLI when you modify your `graphql` files.

If you would like to continue running code generation on each build, you can update your build script to run the CLI `generate` command.

### 4. Refactor your code

Apollo iOS 1.0 was designed to make the migration require as few changes to your code as possible, however there are a number of breaking changes that will require you to refactor some of your code.

Below you will find explanations of each of the breaking API changes and tips on how to address them while migrating to 1.0.

## Breaking Changes

### Custom Scalars

### Cache key configuration

In the 0.x version of Apollo iOS, you could configure the computation of cache keys for the normalized cache by providing a `cacheKeyForObject` block to the `ApolloClient`. In 1.0, this is replaced by a type-safe API in the `SchemaConfiguration.swift` file that is generated alongside your generated schema types.

To migrate your cache key configuration code, refactor your `cacheKeyForObject` implementation into the `SchemaConfiguration.swift` file's [`cacheKeyInfo(for type:object:)`](https://www.apollographql.com/docs/ios/docc/documentation/apolloapi/schemaconfiguration/cachekeyinfo(for:object:)) function. In this function you will return a `CacheKeyInfo` struct, rather than a cache key `String`.

In 0.x, it was recommended that you prefix your cache keys with the `__typename` of the object to prevent key conflicts. In 1.0, this is done automatically for you. If you want to group cache keys for objects of different types together (by a common interface type, for example), you can set the `uniqueKeyGroup` property of the `CacheKeyInfo` you return.

> For a detailed explanation of the new cache key configuration APIs, read the [cache key resolution documentation](./../caching/cache-key-resolution).

Given a `cacheKeyForObject` block:

```swift
client.cacheKeyForObject = {
    guard let typename = $0["__typename"] as? String,
        let id = $0["id"] as? String else {
            return nil
        }

    return "\(typename):\(id)"
}
```

You can migrate this to the new [`cacheKeyInfo(for type:object:)`](https://www.apollographql.com/docs/ios/docc/documentation/apolloapi/schemaconfiguration/cachekeyinfo(for:object:)) function like so:

```swift
public extension MySchema {
  static func cacheKeyInfo(for type: Object, object: JSONObject) -> CacheKeyInfo? {
    guard let id = object["id"] as? String else {
        return nil
    }

    return CacheKeyInfo(id: id)
  }
}
```

Or using the [JSON value convenience initializer](./../caching/cache-key-resolution#json-value-convenience-initializer) like so:

```swift
public extension MySchema {
  static func cacheKeyInfo(for type: Object, object: JSONObject) -> CacheKeyInfo? {
    return try? CacheKeyInfo(jsonValue: object["id"])
  }
}
```
